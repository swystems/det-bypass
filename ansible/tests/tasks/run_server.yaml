# Description: This file is used to run the server program on the devices.
# Parameters:
#   - prog_title: Title of the program, for display purposes (e.g. "XDP Poll")
#   - prog_dir: Directory where the program is located, relative to the base directory (e.g. "xdp")
#   - prog_name: Name of the program (e.g. "xdp_poll")
#   - devices: List of devices to run the program on (e.g. "eth0")
---
- name: "Run {{ prog_title }} (Server)"
  become: yes
  shell: |
    cd {{ base_dir }}/build/{{ prog_dir }}
    nohup {{ execute_command }}./{{ prog_name }} -d {{ item }} -p {{ packets }} {{ extra_args | default('') }} >/dev/null 2>&1 &
  with_items: "{{ devices }}"
  async: 10000000000
  poll: 0